{% extends 'base.html.twig' %}

{% block title %}
	Timeline CV
{% endblock %}

{% block body %}

	<style>
		.timeline-container {
			position: relative; /* Ensure positioning context for pseudo-elements */
		}

		.timeline-container:before {
			content: '';
			position: absolute;
			left: 49vw;
			top: 0;
			bottom: 0;
			width: 1vw;
			background: #ccc;
			box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
		}
	</style>

	<div id="timeline" class="row m-0 p-0 accent-bg-dark" style="min-height: 50vh;">
		{% include 'index/IndexHeader.twig' with {'upRef': 'aboutme', 'textRef': 'timeline', 'headText': 'timeline', 'darkbg': true} %}

		<div class="col-12 row fixed-top py-2 position-sticky main-bg-dark rounded-4">

			<div class="col-md-8 m-0 p-0">
				{% set all_tags = [] %}
				{% for event in timeline_events %}
					{% for tag in event.main.tags %}
						{% if tag not in all_tags %}
							{% set all_tags = all_tags|merge([tag]) %}
						{% endif %}
					{% endfor %}
				{% endfor %}
				<div class="row">
					<h6 class="col-auto ">Filter by Tags:</h6>

					<input type="radio" class="btn-check" name="options-outlined" id="success-outlined" autocomplete="off" checked>
					<label class="col-auto btn btn-outline-success" for="success-outlined" onclick="selectAllTags(true)">All</label>

					<input type="radio" class="btn-check" name="options-outlined" id="danger-outlined" autocomplete="off">
					<label class="col-auto btn btn-outline-danger" for="danger-outlined" onclick="selectAllTags(false)">None</label>
				</div>
				<div class="row">
					{% for tag in all_tags %}
						<input type="checkbox" class="col-auto btn-check" id="btn-check-outlined-{{ tag }}" name="tags" value="{{ tag }}" checked>
						<label class="col-auto btn btn-outline-main" for="btn-check-outlined-{{ tag }}">{{ tag }}</label><br>
					{% endfor %}

				</div>
			</div>
			<div class="col-md-4 m-0 p-0">
				<h6>Filter by Year:</h6>
				<div class="btn-group" role="group" aria-label="Year buttons">
					{% set years = [] %}

					{# Loop through events to gather unique years from both start and end dates #}
					{% for event in timeline_events %}
						{% if event.main.startDate|date('Y') not in years %}
							{% set years = years|merge([event.main.startDate|date('Y')]) %}
						{% endif %}
						{% if event.main.endDate|date('Y') not in years %}
							{% set years = years|merge([event.main.endDate|date('Y')]) %}
						{% endif %}
					{% endfor %}

					{# Sort the years in ascending order #}
					{% set years = years|sort %}

					{# Generate radio buttons for each year #}
					{% for year in years %}
						<input type="radio" class="btn-check" name="btnradio" id="btnradio{{ loop.index }}" autocomplete="off" {% if loop.index == 1 %} checked {% endif %}>
						<label class="btn btn-outline-main" for="btnradio{{ loop.index }}" onclick="showEvents('{{ year }}')">{{ year }}</label>
					{% endfor %}

				</div>
			</div>
		</div>

		{% if years is empty %}

			<h3 class="col-6 my-5 accent-bg-dark text-center mx-auto py-3 text-warning border border-warning rounded-3">
				No events available.
			</h3>

		{% endif %}

		{% for year in years %}
			{% set events_in_year = timeline_events|filter(e => (e.main.startDate|date('Y') == year or e.main.endDate|date('Y') == year)) %}

			<div class="events-wrapper container-fluid row justify-content-center align-items-center text-white m-0" id="events-{{ year }}" style="display: {{ loop.first ? 'block' : 'none' }};">
				<div class="row justify-content-center mt-4 m-0">
					<h4 class="col-auto bg-dark text-center shadow-custom m-0 px-5 py-3 text-warning border border-warning rounded-3">{{ year }}</h4>
				</div>
				<div class="timeline-container row justify-content-center p-0 m-0">
					<!-- Ensure relative positioning for the container -->
					{% for event in events_in_year %}
						<div class="col-12 row justify-content-center">
							<div class="card rounded-4 m-5 shadow-custom timeline-event main-bg-gradient{% if loop.index  % 2 == 0 %}-alter{% endif %}" style="width: 36rem; max-width: 90vw;">

								<div class="card-body row m-0 justify-content-center text-center">

									<h5 class="col-auto card-title">
										<strong class='accent-color'>{{ event.main.startDate|date('F-Y') ~ ' - ' ~ event.main.endDate|date('F-Y') }}</strong>
									</h5>
									<h3 class="col-auto card-title">{{ event.main.name }}</h3>

									<p>Brief Description:</p>
									<p class="m-0">{{ event.main.description != '' ? event.main.description ?? 'not defined' : 'not defined'}}</p>
								</p>

								{% if event.bullets is not empty %}

									<div class="col my-2">
										<button class="custom-btn" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample" aria-expanded="true" aria-controls="collapseWidthExample">
											More Info
										</button>
									</div>

									<div class="col-12">
										<div class="collapse" id="collapseWidthExample">
											<div class="card card-body main-bg-dark">
												<ul class="list-group list-group-flush">
													{% for point in event.bullets %}
														<li class="list-group-item">{{ point.name }}</li>
													{% endfor %}
												</ul>
											</div>
										</div>
									</div>

								{% endif %}

								<h5 class="card-title">Asociated projects:</h5>
								<div class="rounded-4 d-flex justify-content-center bg-dark mx-auto shadow" style="overflow: hidden; aspect-ratio: 1; cursor: pointer; max-width: 7rem;">
									<img src="" style="height: 100%; width: auto;" alt="{{ event.main.name }}">
								</div>
							</div>

							<div class="tags" style="display: none;">{{ event.main.tags|json_encode|raw }}</div>

						</div>
					</div>
				{% endfor %}
				<div class="col-12 d-flex row flex-column justify-content-center align-items-center ">
					<h6 id="noTimelineEvents" class="col-6 py-5 accent-bg-dark text-center mx-auto text-secondary border border-secondary rounded-3" style="display: none; z-index: 100;">
						No events available.
					</h6>
				</div>
			</div>

		</div>

	{% endfor %}
	<div class="row d-flex container-fluid flex-column justify-content-center align-items-center mb-5 p-0 m-0">
		<button class="btn btn-outline-success bg-dark shadow-custom col-3 text-center m-0 py-3" onclick="window.location.href='/#contact'">
			Let's build together!</button>
	</div>

</div>

<script src="{{ asset('js/timeLine.js') }}"></script>{% endblock %}
